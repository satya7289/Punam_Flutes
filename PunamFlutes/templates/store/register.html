{% extends 'store/base.html' %}
{% load staticfiles %}
{% block content %}
<section class="py-5">
  <div class="container">
    <div class="row">

      <div class="col-12 col-md-6 offset-md-3 REGISTRATION" style="display:none">

        <!-- Card -->
        <div class="card card-lg">
          <div class="card-body">
            <div class="col-12">
              <p>
                {% for message in messages %}
                <span class="text-danger center" id="error_login">{{message}}!!!</span><br />
                {% endfor %}
              </p>
            </div>

            <!-- Heading -->
            <h6 class="mb-7">New Customer</h6>

            <!-- Form -->
            <form method="post" action="{% url 'customer_register' %}" id="registrationByEmail">
              {% csrf_token %}
              <div class="row">
                <input type="hidden" name="type" value="email">

                <div class="col-12">
                  <div class="form-group">
                    <label class="sr-only" for="registerEmail">
                      Email Address *
                    </label>
                    <input class="form-control form-control-sm" id="registerEmail" name="email" type="email"
                      placeholder="Email Address *" required>
                    <small id="registerEmailHelpText" class="text-danger">
                      Email already exits
                    </small>
                  </div>

                </div>
                <div class="col-12 col-md-6">

                  <!-- Password -->
                  <div class="form-group">
                    <label class="sr-only" for="registerPassword">
                      Password *
                    </label>
                    <input class="form-control form-control-sm" id="registerPassword" name="password" type="password"
                      placeholder="Password *" required>
                  </div>

                </div>
                <div class="col-12 col-md-6">

                  <!-- Password -->
                  <div class="form-group">
                    <label class="sr-only" for="registerPasswordConfirm">
                      Confirm Password *
                    </label>
                    <input class="form-control form-control-sm" id="registerPasswordConfirm" name="cnf_password"
                      type="password" placeholder="Confrm Password *" required>
                  </div>

                </div>
                <div class="col-12 col-md-auto">

                  <!-- Link -->
                  <div class="form-group font-size-sm text-muted">
                    By registering your details, you agree with our Terms & Conditions,
                    and Privacy and Cookie Policy.
                  </div>

                </div>
                <div class="col-12 col-md">

                  <!-- Newsletter -->
                  <div class="form-group">
                    <div class="custom-control custom-checkbox">
                      <input class="custom-control-input" id="registerNewsletter" name="email_opt" type="checkbox" checked>
                      <label class="custom-control-label" for="registerNewsletter">
                        Sign me up for the Newsletter!
                      </label>
                    </div>
                  </div>

                </div>
                <div class="col-12">
                  <script src='https://www.google.com/recaptcha/api.js'></script>
                  <div class="g-recaptcha" data-sitekey={{SITE_KEY}}></div>
                </div>
                <div class="col-12">

                  <!-- Button -->
                  <button class="btn btn-sm btn-dark" type="submit" id="email__register">
                    Register
                  </button>

                  <button style="display: none;" class="btn btn-sm btn-dark" onclick="registrationViaPhone()">
                    Register via Phone
                  </button>

                </div>
              </div>

            </form>

            <form method="post" action="{% url 'customer_register' %}" id="registrationByPhone">
              {% csrf_token %}
              <div class="row">
                <input type="hidden" name="type" value="phone">
                <input type="hidden" name="phone__verified" id="phone__verified" value="0">
                <div class="col-12 col-md-6">
                  <div class="form-group">
                    <label class="sr-only" for="CountryCode">
                      Country Code
                    </label>
                    <select class="form-control form-control-sm" id="CountryCode" name="country_code"
                      placeholder="Country Code *" required>
                      <option value="">select country code </option>
                      {% for code, countryCode in countryCodes.items %}
                        {% for cCode in countryCode %}
                          <option value="{{ cCode }}">{{ code }}: {{ cCode }}</option>
                        {% endfor %}
                      {% endfor %}

                    </select>
                  </div>

                </div>
                <div class="col-12 col-md-6">

                  <!-- Password -->
                  <div class="form-group">
                    <label class="sr-only" for="PhoneNumber">
                      Phone Number
                    </label>
                    <input class="form-control form-control-sm" id="PhoneNumber" name="phone"
                      type="text" placeholder="Phone Number *" required maxlength="15">
                    <small id="PhoneNumberHelpText" class="text-danger">
                      Phone Number already exits
                    </small>
                  </div>

                </div>
                <div class="col-12 col-md-6">

                  <!-- Password -->
                  <div class="form-group">
                    <label class="sr-only" for="registerPassword">
                      Password *
                    </label>
                    <input class="form-control form-control-sm" id="registerPassword" name="password" type="password"
                      placeholder="Password *" required>
                  </div>

                </div>
                <div class="col-12 col-md-6">

                  <!-- Password -->
                  <div class="form-group">
                    <label class="sr-only" for="registerPasswordConfirm">
                      Confirm Password *
                    </label>
                    <input class="form-control form-control-sm" id="registerPasswordConfirm" name="cnf_password"
                      type="password" placeholder="Confrm Password *" required>
                  </div>

                </div>

                <!-- <div class="col-12 col-md-6 OTP">
                  <div class="form-group">
                    <button class="btn btn-sm btn-dark" id="send__opt">
                      Send OTP
                    </button>
                  </div>
                </div>

                <div class="col-12 col-md-6 OTP">
                  <div class="form-group">
                    <label class="sr-only" for="sendOTP">
                      Send OTP
                    </label>
                    <input class="form-control form-control-sm" id="sendOTP" name="otp"
                      type="text" placeholder="OTP *" required>
                  </div>
                </div> -->

                <div class="col-12 col-md-auto">
                  <!-- Link -->
                  <div class="form-group font-size-sm text-muted">
                    By registering your details, you agree with our Terms & Conditions,
                    and Privacy and Cookie Policy.
                  </div>

                </div>
                <div class="col-12 col-md">
                </div>
                <div class="col-12">

                  <!-- Button -->
                  <button class="btn btn-sm btn-dark" type="submit" id="phone__register">
                    Register
                  </button>
                  <button class="btn btn-sm btn-dark" onclick="registrationViaEmail()">
                    Register via Email
                  </button>
                </div>
              </div>

            </form>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

{% endblock %}
{% block script %}
<script>
  $(document).ready(()=>{
    $('.REGISTRATION').show();
    $('#registrationByPhone').hide();
    $('#PhoneNumberHelpText').hide();
    $('#registerEmailHelpText').hide();
    $('#send__opt').prop('disabled', true);
    $('#email__register').prop('disabled', true);
  });

  function registrationViaEmail(){
    $('#registrationByPhone').hide();
    $('#registrationByEmail').show();
    $('#email__register').prop('disabled', true);    
  }
  function registrationViaPhone(){
    $('#registrationByPhone').show();
    $('#registrationByEmail').hide();
    $('#PhoneNumber').prop('disabled', true);
    $('#phone__register').prop('disabled', true);
  }

  $('#CountryCode').change(function(){
    if($('#CountryCode').val()!=""){
      $('#PhoneNumber').prop('disabled', false);
    }else{
      $('#PhoneNumber').prop('disabled', true);
    }
  })

  /* Email validation */
  const emailPatt = new RegExp(/^[a-zA-Z0-9.!'*+_`{|}~-]+@([a-zA-Z])+\.([a-zA-Z])+$/);
  $('#registerEmail').keyup(function(){
    if(emailPatt.test($(this).val())){
      $.ajax({
        url: "{% url 'check_username' %}",
        data: {'type': 'email', 'email': $(this).val()},
        success: function(data){
          console.log(data.status, data.status=="0")
          if(data.status=="1"){   // email exits
            if($('#registerEmail').hasClass('is-valid')){
              $('#registerEmail').removeClass('is-valid');
            }
            $('#registerEmail').addClass('is-invalid');
            $('#email__register').prop('disabled', true);
            $('#registerEmailHelpText').show();  
          }else if(data.status=="0"){   // email not exits
            if($('#registerEmail').hasClass('is-invalid')){
              $('#registerEmail').removeClass('is-invalid');
            }
            $('#registerEmail').addClass('is-valid');
            $('#email__register').prop('disabled', false);
            $('#registerEmailHelpText').hide();    
          }
        }
      });
    }else{
      if($('#registerEmail').hasClass('is-valid')){
        $('#registerEmail').removeClass('is-valid');
      }
      if(!$('#registerEmail').hasClass('is-invalid')){
        $('#registerEmail').addClass('is-invalid');
      }
      $('#email__register').prop('disabled', true);
      $('#registerEmailHelpText').hide();    
    }
  });

  /* Phone validation */
  $('#PhoneNumber').keyup(function(){
    if($('#CountryCode').val()!="" && $(this).val()!=""){
      $.ajax({
        url: "{% url 'check_username' %}",
        data: {'type': 'phone', 'phone': $(this).val(), 'country_code':$('#CountryCode').val()},
        success: function(data){
          console.log(data.status, data.status=="0")
          if(data.status=="1"){   // phone exits
            if($('#PhoneNumber').hasClass('is-valid')){
              $('#PhoneNumber').removeClass('is-valid');
            }
            $('#PhoneNumber').addClass('is-invalid');
            $('#send__opt').prop('disabled', true);
            $('#phone__register').prop('disabled', true);
            $('#PhoneNumberHelpText').show();
          }else if(data.status=="0"){   // phone not exits
            if($('#PhoneNumber').hasClass('is-invalid')){
              $('#PhoneNumber').removeClass('is-invalid');
            }
            $('#PhoneNumber').addClass('is-valid');
            $('#send__opt').prop('disabled', false);
            $('#phone__register').prop('disabled', false);
            $('#PhoneNumberHelpText').hide();
          }
        }
      });

    }else{
      if($('#PhoneNumber').hasClass('is-valid')){
        $('#PhoneNumber').removeClass('is-valid');
      }
      if(!$('#PhoneNumber').hasClass('is-invalid')){
        $('#PhoneNumber').addClass('is-invalid');
      }

      $('#send__opt').prop('disabled', true);
      $('#email__register').prop('disabled', true);
      $('#PhoneNumberHelpText').hide();
    }
  })
</script>
{% endblock %}
